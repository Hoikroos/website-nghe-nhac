<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tìm kiếm - Hệ thống quản lý nhạc</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;600;700&family=Open+Sans:wght@400;500;600&display=swap"
        rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --background: #ffffff;
            --foreground: #1f2937;
            --card: #f1f5f9;
            --card-foreground: #1f2937;
            --primary: #1f2937;
            --primary-foreground: #ffffff;
            --secondary: #6b7280;
            --secondary-foreground: #ffffff;
            --muted: #f1f5f9;
            --muted-foreground: #6b7280;
            --accent: #8b5cf6;
            --accent-foreground: #ffffff;
            --destructive: #be123c;
            --destructive-foreground: #ffffff;
            --border: #e5e7eb;
            --input: #ffffff;
            --ring: rgba(139, 92, 246, 0.5);
            --radius: 0.5rem;
            --sidebar: #f1f5f9;
            --sidebar-foreground: #1f2937;
            --sidebar-primary: #1f2937;
            --sidebar-primary-foreground: #ffffff;
            --sidebar-accent: #8b5cf6;
            --sidebar-accent-foreground: #ffffff;
            --sidebar-border: #e5e7eb;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Open Sans', sans-serif;
            background: var(--background);
            color: var(--foreground);
            line-height: 1.6;
        }

        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar styles */
        .sidebar {
            width: 280px;
            background: var(--sidebar);
            border-right: 1px solid var(--sidebar-border);
            padding: 1.5rem 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 0 1.5rem 2rem;
            border-bottom: 1px solid var(--sidebar-border);
            margin-bottom: 1.5rem;
        }

        .sidebar-header h1 {
            font-family: 'Work Sans', sans-serif;
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--sidebar-primary);
            margin-bottom: 0.5rem;
        }

        .sidebar-nav {
            padding: 0 1rem;
        }

        .nav-group {
            margin-bottom: 2rem;
        }

        .nav-group-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--muted-foreground);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.75rem;
            padding: 0 0.5rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 0.5rem;
            margin-bottom: 0.25rem;
            border-radius: var(--radius);
            color: var(--sidebar-foreground);
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .nav-item:hover {
            background: var(--background);
            color: var(--sidebar-accent);
        }

        .nav-item.active {
            background: var(--sidebar-accent);
            color: var(--sidebar-accent-foreground);
        }

        .nav-item i {
            width: 20px;
            margin-right: 0.75rem;
            font-size: 1rem;
        }

        .user-info {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--sidebar-border);
            margin-top: auto;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--sidebar-accent);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--sidebar-accent-foreground);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .user-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .user-role {
            font-size: 0.8rem;
            color: var(--muted-foreground);
        }

        /* Main content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 2rem;
        }

        .main-header {
            margin-bottom: 2rem;
        }

        .main-header h1 {
            font-family: 'Work Sans', sans-serif;
            font-weight: 700;
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .main-header p {
            color: var(--muted-foreground);
        }

        /* Search section */
        .search-section {
            background: var(--card);
            padding: 2rem;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        .search-form {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .search-input {
            flex: 1;
            padding: 1rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--input);
            color: var(--foreground);
            font-size: 1.1rem;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--ring);
        }

        .search-btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: var(--radius);
            background: var(--accent);
            color: var(--accent-foreground);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            background: #7c3aed;
            transform: translateY(-1px);
        }

        .search-filters {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-group label {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--foreground);
        }

        .filter-group select {
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--input);
            color: var(--foreground);
        }

        /* Results section */
        .results-section {
            margin-bottom: 2rem;
        }

        .results-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .results-title {
            font-family: 'Work Sans', sans-serif;
            font-weight: 600;
            font-size: 1.25rem;
            color: var(--primary);
        }

        .results-count {
            color: var(--muted-foreground);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .result-card {
            background: var(--card);
            border-radius: var(--radius);
            border: 1px solid var(--border);
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .result-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .result-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .result-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .result-icon.artist {
            background: #ec4899;
        }

        .result-icon.album {
            background: #f59e0b;
        }

        .result-icon.track {
            background: #10b981;
        }

        .result-icon.playlist {
            background: var(--accent);
        }

        .result-info h3 {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .result-info p {
            font-size: 0.9rem;
            color: var(--muted-foreground);
        }

        .result-meta {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: var(--muted-foreground);
        }

        .result-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: var(--radius);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--accent);
            color: var(--accent-foreground);
        }

        .btn-secondary {
            background: var(--secondary);
            color: var(--secondary-foreground);
        }

        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.8rem;
        }

        .type-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.8rem;
            font-weight: 500;
            background: var(--muted);
            color: var(--foreground);
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--muted-foreground);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            color: var(--muted-foreground);
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--foreground);
        }

        /* Mobile responsive */
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 1000;
            background: var(--accent);
            color: var(--accent-foreground);
            border: none;
            padding: 0.75rem;
            border-radius: var(--radius);
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                z-index: 999;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 1rem;
                padding-top: 4rem;
            }

            .mobile-menu-btn {
                display: block;
            }

            .search-form {
                flex-direction: column;
            }

            .search-filters {
                flex-direction: column;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <!-- Mobile Menu Button -->
        <button class="mobile-menu-btn" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </button>
        <div th:replace="~{/layout/slidesbarMusican}"></div>

        <!-- Main Content -->
        <main class="main-content">
            <div class="main-header">
                <h1>Tìm kiếm</h1>
                <p>Tìm kiếm nghệ sĩ, album, bài hát và playlist trong hệ thống</p>
            </div>

            <!-- Search Section -->
            <div class="search-section">
                <form class="search-form" onsubmit="performSearch(event)">
                    <input type="text" class="search-input" id="searchQuery" placeholder="Nhập từ khóa tìm kiếm..."
                        autocomplete="off">
                    <button type="submit" class="search-btn">
                        <i class="fas fa-search"></i>
                        Tìm kiếm
                    </button>
                </form>

                <div class="search-filters">
                    <div class="filter-group">
                        <label>Loại nội dung</label>
                        <select id="searchType">
                            <option value="all">Tất cả</option>
                            <option value="artist">Nghệ sĩ</option>
                            <option value="album">Album</option>
                            <option value="track">Bài hát</option>
                            <option value="playlist">Playlist</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Thể loại</label>
                        <select id="searchCategory">
                            <option value="">Tất cả thể loại</option>
                            <option value="pop">Pop</option>
                            <option value="rock">Rock</option>
                            <option value="jazz">Jazz</option>
                            <option value="classical">Classical</option>
                            <option value="hiphop">Hip Hop</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Sắp xếp</label>
                        <select id="searchSort">
                            <option value="relevance">Liên quan</option>
                            <option value="name">Tên A-Z</option>
                            <option value="date">Ngày tạo</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div class="results-section" id="resultsSection" style="display: none;">
                <div class="results-header">
                    <h2 class="results-title">Kết quả tìm kiếm</h2>
                    <span class="results-count" id="resultsCount">0 kết quả</span>
                </div>
                <div class="results-grid" id="resultsGrid">
                    <!-- Results will be loaded here -->
                </div>
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="emptyState">
                <i class="fas fa-search"></i>
                <h3>Tìm kiếm nội dung</h3>
                <p>Nhập từ khóa để tìm kiếm nghệ sĩ, album, bài hát hoặc playlist</p>
            </div>

            <!-- No Results State -->
            <div class="empty-state" id="noResultsState" style="display: none;">
                <i class="fas fa-search-minus"></i>
                <h3>Không tìm thấy kết quả</h3>
                <p>Thử thay đổi từ khóa hoặc bộ lọc tìm kiếm</p>
            </div>
        </main>
    </div>

    <script>
        let artists = [];
        let albums = [];
        let tracks = [];
        let playlists = [];
        let currentUser = null;

        // Initialize
        function init() {
            checkAuth();
            loadUserInfo();
            loadData();
        }

        // Authentication functions
        // function checkAuth() {
        //     const userData = localStorage.getItem('currentUser');
        //     if (!userData) {
        //         window.location.href = 'login.html';
        //         return;
        //     }
        //     currentUser = JSON.parse(userData);
        // }

        // function loadUserInfo() {
        //     if (currentUser.username) {
        //         document.getElementById('userName').textContent = currentUser.displayName || currentUser.username;
        //         document.getElementById('userRole').textContent = getRoleText(currentUser.role);
        //         document.getElementById('userAvatar').textContent = (currentUser.displayName || currentUser.username).charAt(0).toUpperCase();
        //     }
        // }

        // function getRoleText(role) {
        //     switch(role) {
        //         case 'ADMIN': return 'Quản trị viên';
        //         case 'MUSICIAN': return 'Nhạc sĩ';
        //         case 'USER': return 'Người dùng';
        //         default: return 'Người dùng';
        //     }
        // }

        // function logout() {
        //     if (confirm('Bạn có chắc chắn muốn đăng xuất?')) {
        //         localStorage.removeItem('currentUser');
        //         window.location.href = 'login.html';
        //     }
        // }

        // Load data
        function loadData() {
            artists = JSON.parse(localStorage.getItem('artists') || '[]');
            albums = JSON.parse(localStorage.getItem('albums') || '[]');
            tracks = JSON.parse(localStorage.getItem('tracks') || '[]');
            playlists = JSON.parse(localStorage.getItem('playlists') || '[]');
        }

        // Sidebar functions
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }

        // Search functions
        function performSearch(event) {
            event.preventDefault();

            const query = document.getElementById('searchQuery').value.trim().toLowerCase();
            const type = document.getElementById('searchType').value;
            const category = document.getElementById('searchCategory').value;
            const sort = document.getElementById('searchSort').value;

            if (!query) {
                alert('Vui lòng nhập từ khóa tìm kiếm!');
                return;
            }

            const results = searchContent(query, type, category, sort);
            displayResults(results, query);
        }

        function searchContent(query, type, category, sort) {
            let results = [];

            // Search artists
            if (type === 'all' || type === 'artist') {
                const artistResults = artists.filter(artist => {
                    const nameMatch = artist.name.toLowerCase().includes(query);
                    const bioMatch = artist.bio && artist.bio.toLowerCase().includes(query);
                    const categoryMatch = !category || artist.category === category;
                    return (nameMatch || bioMatch) && categoryMatch;
                }).map(artist => ({
                    ...artist,
                    type: 'artist',
                    searchScore: calculateScore(artist.name, query)
                }));
                results = results.concat(artistResults);
            }

            // Search albums
            if (type === 'all' || type === 'album') {
                const albumResults = albums.filter(album => {
                    const titleMatch = album.title.toLowerCase().includes(query);
                    const artist = artists.find(a => a.id === album.artistId);
                    const artistMatch = artist && artist.name.toLowerCase().includes(query);
                    const categoryMatch = !category || (artist && artist.category === category);
                    return (titleMatch || artistMatch) && categoryMatch;
                }).map(album => ({
                    ...album,
                    type: 'album',
                    searchScore: calculateScore(album.title, query)
                }));
                results = results.concat(albumResults);
            }

            // Search tracks
            if (type === 'all' || type === 'track') {
                const trackResults = tracks.filter(track => {
                    const titleMatch = track.title.toLowerCase().includes(query);
                    const album = albums.find(a => a.id === track.albumId);
                    const albumMatch = album && album.title.toLowerCase().includes(query);
                    const artist = album ? artists.find(a => a.id === album.artistId) : null;
                    const artistMatch = artist && artist.name.toLowerCase().includes(query);
                    const categoryMatch = !category || (artist && artist.category === category);
                    return (titleMatch || albumMatch || artistMatch) && categoryMatch;
                }).map(track => ({
                    ...track,
                    type: 'track',
                    searchScore: calculateScore(track.title, query)
                }));
                results = results.concat(trackResults);
            }

            // Search playlists
            if (type === 'all' || type === 'playlist') {
                const playlistResults = playlists.filter(playlist => {
                    const titleMatch = playlist.title.toLowerCase().includes(query);
                    const descMatch = playlist.description && playlist.description.toLowerCase().includes(query);
                    return titleMatch || descMatch;
                }).map(playlist => ({
                    ...playlist,
                    type: 'playlist',
                    searchScore: calculateScore(playlist.title, query)
                }));
                results = results.concat(playlistResults);
            }

            // Sort results
            return sortResults(results, sort);
        }

        function calculateScore(text, query) {
            const lowerText = text.toLowerCase();
            const lowerQuery = query.toLowerCase();

            if (lowerText === lowerQuery) return 100;
            if (lowerText.startsWith(lowerQuery)) return 80;
            if (lowerText.includes(lowerQuery)) return 60;
            return 40;
        }

        function sortResults(results, sortType) {
            switch (sortType) {
                case 'name':
                    return results.sort((a, b) => {
                        const nameA = a.name || a.title;
                        const nameB = b.name || b.title;
                        return nameA.localeCompare(nameB);
                    });
                case 'date':
                    return results.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                case 'relevance':
                default:
                    return results.sort((a, b) => b.searchScore - a.searchScore);
            }
        }

        function displayResults(results, query) {
            const resultsSection = document.getElementById('resultsSection');
            const emptyState = document.getElementById('emptyState');
            const noResultsState = document.getElementById('noResultsState');
            const resultsGrid = document.getElementById('resultsGrid');
            const resultsCount = document.getElementById('resultsCount');

            emptyState.style.display = 'none';

            if (results.length === 0) {
                resultsSection.style.display = 'none';
                noResultsState.style.display = 'block';
                return;
            }

            noResultsState.style.display = 'none';
            resultsSection.style.display = 'block';
            resultsCount.textContent = `${results.length} kết quả cho "${query}"`;

            resultsGrid.innerHTML = results.map(item => {
                const itemData = getItemData(item);
                return `
                    <div class="result-card">
                        <div class="result-header">
                            <div class="result-icon ${item.type}">
                                <i class="fas fa-${itemData.icon}"></i>
                            </div>
                            <div class="result-info">
                                <h3>${itemData.title}</h3>
                                <p>${itemData.subtitle}</p>
                            </div>
                        </div>
                        <div class="result-meta">
                            <span class="type-badge">${itemData.typeText}</span>
                            <span>Tạo: ${formatDate(item.createdAt)}</span>
                        </div>
                        <div class="result-actions">
                            <button class="btn btn-sm btn-secondary" onclick="viewItem('${item.type}', ${item.id})">
                                <i class="fas fa-eye"></i>
                                Xem
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="addToFavorites('${item.type}', ${item.id})">
                                <i class="fas fa-heart"></i>
                                Yêu thích
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getItemData(item) {
            switch (item.type) {
                case 'artist':
                    return {
                        title: item.name,
                        subtitle: item.bio || 'Nghệ sĩ',
                        icon: 'microphone',
                        typeText: 'Nghệ sĩ'
                    };
                case 'album':
                    const artist = artists.find(a => a.id === item.artistId);
                    return {
                        title: item.title,
                        subtitle: artist ? artist.name : 'Nghệ sĩ không xác định',
                        icon: 'compact-disc',
                        typeText: 'Album'
                    };
                case 'track':
                    const album = albums.find(a => a.id === item.albumId);
                    return {
                        title: item.title,
                        subtitle: album ? album.title : 'Không có album',
                        icon: 'music',
                        typeText: 'Bài hát'
                    };
                case 'playlist':
                    return {
                        title: item.title,
                        subtitle: item.description || 'Playlist',
                        icon: 'list',
                        typeText: 'Playlist'
                    };
                default:
                    return {
                        title: 'Unknown',
                        subtitle: '',
                        icon: 'question',
                        typeText: 'Unknown'
                    };
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('vi-VN');
        }

        function viewItem(type, id) {
            switch (type) {
                case 'artist':
                    window.location.href = 'artists.html';
                    break;
                case 'album':
                    window.location.href = 'albums.html';
                    break;
                case 'track':
                    window.location.href = 'tracks.html';
                    break;
                case 'playlist':
                    window.location.href = 'playlists.html';
                    break;
            }
        }

        function addToFavorites(type, id) {
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');

            // Check if already in favorites
            const exists = favorites.some(fav => {
                switch (type) {
                    case 'artist': return fav.artistId === id;
                    case 'album': return fav.albumId === id;
                    case 'track': return fav.trackId === id;
                    case 'playlist': return fav.playlistId === id;
                    default: return false;
                }
            });

            if (exists) {
                alert('Mục này đã có trong danh sách yêu thích!');
                return;
            }

            // Add to favorites
            const newFavorite = {
                id: Date.now(),
                accountId: currentUser.id || 1,
                artistId: type === 'artist' ? id : null,
                albumId: type === 'album' ? id : null,
                trackId: type === 'track' ? id : null,
                playlistId: type === 'playlist' ? id : null,
                createdAt: new Date().toISOString().split('T')[0]
            };

            favorites.push(newFavorite);
            localStorage.setItem('favorites', JSON.stringify(favorites));
            alert('Đã thêm vào danh sách yêu thích!');
        }

        // Initialize when page loads
        window.addEventListener('load', init);
    </script>
</body>

</html>